# Stage 3B: 基因通路深度分析报告

## 分析概述

本分析使用**仅基因特征**的模型，深入研究各基因和通路在预测子宫内膜癌风险中的作用。

### 数据规模
- 训练样本: 289
- 测试样本: 73
- 基因特征数: 879
- 通路数: 7

### 模型配置
- Pipeline: StandardScaler → SelectKBest(k=500) → ElasticNet Logistic Regression
- 验证策略: 5-Fold × 3 重复 = 15次训练
- Permutation Importance: n_repeats=10

---

## 重要性指标对比

### Importance Score vs Permutation Importance

| 指标 | 定义 | 优势 | 更适合 |
|------|------|------|--------|
| **Importance Score** | 频率 × \|系数中位数\| | 反映模型使用频率和系数大小 | 理解模型偏好 |
| **Permutation Importance** ⭐ | 打乱特征后性能下降幅度 | 直接衡量实际贡献 | **评估真实重要性** |

**结论**: Permutation Importance 更能体现特征在分类中的重要作用，因为它测量了该特征对模型预测能力的实际影响。

### 基因层面相关性

- **被选中的基因数**: 564 / 879 (64.2%)
- **高频基因 (>50%)**: 152
- **两指标相关性** (仅被选中基因):
  - Pearson r = -0.020
  - Spearman r = -0.023

---

## Top 50 基因

### 按 Importance Score 排名

| 排名 | 基因 | 通路 | 选择频率 | 系数中位数 | Importance Score |
|------|------|------|----------|-----------|-----------------|
| 1 | CCND2 | WNT_hsa04310 | 0.93 | -0.6166 | 0.5755 |
| 2 | MDM2 | PI3K_Akt_hsa04151 | 1.00 | -0.5586 | 0.5586 |
| 3 | IFNA17 | PI3K_Akt_hsa04151 | 0.93 | +0.5953 | 0.5556 |
| 4 | CACNG5 | MAPK_hsa04010 | 0.87 | -0.6193 | 0.5367 |
| 5 | PIK3C2B | IGF1_signaling | 1.00 | +0.5247 | 0.5247 |
| 6 | FGF16 | PI3K_Akt_hsa04151 | 0.73 | +0.6803 | 0.4989 |
| 7 | HSPA1B | MAPK_hsa04010 | 1.00 | +0.4835 | 0.4835 |
| 8 | MAPK8IP3 | MAPK_hsa04010 | 0.60 | +0.7690 | 0.4614 |
| 9 | DUSP6 | MAPK_hsa04010 | 0.93 | -0.4795 | 0.4475 |
| 10 | CCNE1 | PI3K_Akt_hsa04151 | 1.00 | -0.4336 | 0.4336 |
| 11 | OSMR | PI3K_Akt_hsa04151 | 1.00 | +0.4318 | 0.4318 |
| 12 | IGF1R | PI3K_Akt_hsa04151 | 0.80 | -0.5288 | 0.4230 |
| 13 | LPIN1 | mTOR_hsa04150 | 0.93 | +0.4307 | 0.4020 |
| 14 | SSBP1 | MMR_hsa03430 | 0.93 | +0.4281 | 0.3996 |
| 15 | BAMBI | WNT_hsa04310 | 1.00 | -0.3757 | 0.3757 |
| 16 | NFATC1 | WNT_hsa04310 | 0.80 | -0.4662 | 0.3730 |
| 17 | SERPINB5 | p53_hsa04115 | 0.80 | +0.4637 | 0.3709 |
| 18 | IGFBP5 | IGF1_signaling | 0.87 | +0.4246 | 0.3680 |
| 19 | FOSL1 | WNT_hsa04310 | 0.67 | +0.5367 | 0.3578 |
| 20 | CXXC4 | WNT_hsa04310 | 0.67 | +0.5093 | 0.3395 |

### 按 Permutation Importance 排名

| 排名 | 基因 | 通路 | Perm Importance | 标准差 | Importance Score |
|------|------|------|----------------|--------|-----------------|
| 1 | PRICKLE2 | WNT_hsa04310 | +0.0371 | 0.0135 | 0.0085 |
| 2 | PLCB4 | WNT_hsa04310 | +0.0271 | 0.0105 | 0.0000 |
| 3 | IFNA6 | PI3K_Akt_hsa04151 | +0.0261 | 0.0142 | 0.0000 |
| 4 | PTPN7 | MAPK_hsa04010 | +0.0216 | 0.0115 | 0.0081 |
| 5 | SESN3 | p53_hsa04115 | +0.0151 | 0.0118 | 0.0249 |
| 6 | EFNA1 | PI3K_Akt_hsa04151 | +0.0146 | 0.0086 | 0.0418 |
| 7 | FOXO1 | IGF1_signaling | +0.0143 | 0.0060 | 0.0000 |
| 8 | ITGA5 | PI3K_Akt_hsa04151 | +0.0139 | 0.0055 | 0.0910 |
| 9 | COL4A2 | PI3K_Akt_hsa04151 | +0.0136 | 0.0097 | 0.0283 |
| 10 | TCL1A | PI3K_Akt_hsa04151 | +0.0136 | 0.0080 | 0.0161 |
| 11 | VANGL1 | WNT_hsa04310 | +0.0121 | 0.0075 | 0.0149 |
| 12 | DUSP9 | MAPK_hsa04010 | +0.0120 | 0.0187 | 0.0119 |
| 13 | RALB | IGF1_signaling | +0.0110 | 0.0078 | 0.0416 |
| 14 | FZD8 | WNT_hsa04310 | +0.0107 | 0.0054 | 0.0124 |
| 15 | IL3RA.3 | Unknown | +0.0105 | 0.0026 | 0.0000 |
| 16 | PPP2R2B | PI3K_Akt_hsa04151 | +0.0105 | 0.0101 | 0.0338 |
| 17 | PPM1D | p53_hsa04115 | +0.0100 | 0.0075 | 0.0000 |
| 18 | GTSE1 | p53_hsa04115 | +0.0093 | 0.0030 | 0.0109 |
| 19 | TAB1 | MAPK_hsa04010 | +0.0085 | 0.0067 | 0.0006 |
| 20 | LEF1 | WNT_hsa04310 | +0.0084 | 0.0045 | 0.0072 |

---

## 通路级别分析

### 通路排名（按标准化 Importance Score）

| 排名 | 通路 | 基因数 | 选中率 | Norm. Imp Score | Norm. Perm Imp |
|------|------|--------|--------|----------------|----------------|
| 1 | MMR_hsa03430 | 23 | 78.3% | 0.0641 | -0.0001 |
| 2 | IGF1_signaling | 43 | 65.1% | 0.0622 | +0.0008 |
| 3 | mTOR_hsa04150 | 67 | 70.1% | 0.0543 | -0.0006 |
| 4 | PI3K_Akt_hsa04151 | 351 | 64.7% | 0.0488 | -0.0001 |
| 5 | MAPK_hsa04010 | 159 | 67.9% | 0.0454 | +0.0001 |
| 6 | p53_hsa04115 | 56 | 62.5% | 0.0439 | +0.0005 |
| 7 | WNT_hsa04310 | 174 | 58.0% | 0.0420 | +0.0001 |

### 标准化方法说明

为了公平比较不同大小的通路，我们使用**标准化分数**：

```
Normalized Score = Sum(基因得分) / 基因数量
```

这样可以避免大通路仅因基因数量多而得分高的偏差。

### 通路特征汇总

| 通路 | 基因数 | Max Imp Score | Max Perm Imp | 总和 Imp Score | 总和 Perm Imp |
|------|--------|--------------|--------------|---------------|---------------|
| MMR_hsa03430 | 23 | 0.3996 | +0.0018 | 1.4732 | -0.0028 |
| IGF1_signaling | 43 | 0.5247 | +0.0143 | 2.6762 | +0.0359 |
| mTOR_hsa04150 | 67 | 0.4020 | +0.0053 | 3.6366 | -0.0377 |
| PI3K_Akt_hsa04151 | 351 | 0.5586 | +0.0261 | 17.1210 | -0.0481 |
| MAPK_hsa04010 | 159 | 0.5367 | +0.0216 | 7.2149 | +0.0106 |
| p53_hsa04115 | 56 | 0.3709 | +0.0151 | 2.4589 | +0.0287 |
| WNT_hsa04310 | 174 | 0.5755 | +0.0371 | 7.3112 | +0.0197 |

---

## 关键发现

### 1. 最重要的基因（综合两指标）

交集分析 - 同时出现在两个Top 20中的基因：


⚠️ 两个Top 20中没有重叠基因，说明两种指标捕捉到不同的特征重要性维度。


### 2. 最重要的通路

按标准化Importance Score排名：

1. **MMR_hsa03430**
   - 基因数: 23
   - 标准化Importance Score: 0.0641
   - 标准化Permutation Importance: -0.0001
   - 选中率: 78.3%

2. **IGF1_signaling**
   - 基因数: 43
   - 标准化Importance Score: 0.0622
   - 标准化Permutation Importance: +0.0008
   - 选中率: 65.1%

3. **mTOR_hsa04150**
   - 基因数: 67
   - 标准化Importance Score: 0.0543
   - 标准化Permutation Importance: -0.0006
   - 选中率: 70.1%


### 3. 指标差异分析

- **高Importance Score但低Permutation Importance**: 可能是冗余特征（与其他特征高度相关）
- **低Importance Score但高Permutation Importance**: 可能是被忽略但实际很重要的特征
- **两者都高**: 真正重要且稳定的特征

---

## 生物学解释

### 重要基因的功能

基于Top基因和通路分析，以下机制可能与子宫内膜癌风险相关：

1. **细胞增殖和生长** (PI3K-Akt, IGF1, mTOR通路)
2. **信号转导** (MAPK, WNT通路)
3. **DNA修复** (MMR通路)
4. **细胞周期调控** (p53通路)

---

## 输出文件

- `gene_importance_full.csv`: 所有基因的完整重要性统计
- `top50_by_importance_score.csv`: Top 50基因（按Importance Score）
- `top50_by_permutation_importance.csv`: Top 50基因（按Permutation Importance）
- `pathway_summary.csv`: 通路级别汇总统计
- `gene_pathway_analysis.png`: 综合可视化

---

生成时间: {pd.Timestamp.now().strftime('%Y-%m-%d %H:%M:%S')}
